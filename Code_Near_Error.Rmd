---
title: "Near Analysis - Error"
author: "JD Stewart (@thecrobe)"
output:
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: inline
---
```{r Introduction, echo=FALSE}

# The goal of this study is to answer:

#"Are crop yields greater inside or outside the crop's geographic center of origin as a function of escaping pest and pathogen pressure?"

# Reproducibility

#This document can be regenerated using Rmarkdown and the associated R-script (Analyses_Figures.R). This R-script, in combination with the supplementary data files (available online at github.com/thecrobe) also allows for full reproducibility of all the the figures and analyses conducted in R. All other analyses are conducted in ArcMap by ESRI. 
```

```{r Packages, include=TRUE, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE}

#models
library(wPerm)
library(caret)
library(wPerm)
#library(spatialEco)
#library(rgdal)
library(RVAideMemoire)
library(nlme)

#plots
library(RColorBrewer)
library(ggplot2)
library(wesanderson)

#data wrangling
library(reshape2)
library(dplyr)
library(Hmisc)

### Graphics

theme_justin<-theme_bw() +theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())
```


## Near Analysis Error

<div class = "col-md-4">
<br><br> **What Was Tested:** Does modeling error of crop yields vary spatially as a function of escaping GCO?? 
</div>

<div class = "col-md-4">
<br><br> **What This Allows Me To Do:** Identify if error-distance relationships (near analysis) are a function of evolutionary escape or other variables.
</div>

<div class = "col-md-4">
<br><br> **What Are The Model Assumptions:** GLS models are used as they have less assumptions about error structure and heteroscadicity. 
</div>

#Barley -
```{r, message=TRUE, warning=FALSE, cache=TRUE, fig.cap="Barley Near near Model, "}

#Select Data and Rescale Distance
near<-read.csv(file = "Near_Error/Barley_Error_Near.csv", header=T)
near$rescale_ND <- near$NEAR_DIST/(1000*1000)
barley.near<-near %>% select(Barley_Error_Ratio,rescale_ND)
barley.near$logBarleyError<-log10(barley.near$Barley_Error_Ratio)
barley.near<-na.omit(barley.near)
#Plot
ggplot(barley.near, aes(x=rescale_ND, y=logBarleyError)) +
  geom_point(alpha=0.1, color="#00A9B4") + geom_smooth(method = "lm",color="#DB3500") + labs(color='GCO') +theme_justin +xlab("Distance From GCO (1000's km)") +ylab ("Log10 Yield")

###  Model - Barley 
# regular OLS no variance structure
barley.ols <- gls(logBarleyError ~ rescale_ND, data = barley.near)
# varFixed (variance changes linearly with X)
barley.fixed <- update(barley.ols, . ~., weights = varFixed(~rescale_ND))
# varPower (variance changes as a power function with X)
barley.power <- update(barley.ols, . ~ ., weights = varPower(form = ~rescale_ND))
# varExp (variance changes as an exponential function of x)
barley.exp <- update(barley.ols, . ~., weights = varExp(form = ~ rescale_ND)) # error
# varConstPower (constant plus a power function of X (useful if X includes 0))
barley.ConstPower <- update(barley.ols, . ~., weights = varConstPower(form = ~ rescale_ND))
# compare all models by AIC
AIC(barley.ols, barley.fixed, barley.power, barley.ConstPower, barley.exp)
#varPower
summary(barley.ConstPower)
```
